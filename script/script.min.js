import{saveTeam,saveAnswer,saveResult}from"./data.js";let currentIndex=0;const teamName=getTeamNameLocal();function attachAnswerListners(){removeClassFromElements("quiz","quizLocked");const answers=document.querySelectorAll(".answer");let qidForRadio="";answers.forEach(box=>{box.addEventListener("click",()=>{answers.forEach(b=>{const parentElement=box.parentElement,classNames=parentElement.classList,qid=classNames[1],abc=document.querySelectorAll(".options."+qid+" .answer");abc.forEach(def=>{def.classList.remove("answer-selected")}),qidForRadio=qid}),box.classList.add("answer-selected");let www,ele,boxNum=box.id.split("-")[1];const correspondingRadio=document.querySelector(`input[id="${qidForRadio}${boxNum}"]`);correspondingRadio.checked=!0})})}function displayCurrentItem(){if("undefined"!=typeof steps){if(currentIndex>=0&&currentIndex<steps.length){const currentItem=steps[currentIndex],resultDiv=document.getElementById("w_result"),w_titleDiv=document.getElementById("w_title"),w_contentDiv=document.getElementById("w_content"),w_image=document.getElementById("w_image"),w_directions=document.getElementById("w_directions"),w_quiz=document.getElementById("w_quiz"),w_infoDiv=document.getElementById("w_info"),w_warningDiv=document.getElementById("w_warning"),w_mediaDiv1=document.getElementById("w_media_1"),b_checkAnswers=document.getElementById("btnCheckAnswers");w_titleDiv.innerHTML=`${currentItem.name}`,w_contentDiv.innerHTML=`${currentItem.place}`,w_image.innerHTML=`<img src='assets/img/${currentItem.image}'>`,currentItem.video&&(w_image.innerHTML=`<div style="padding:56.25% 0 0 0;position:relative;"><iframe src="${currentItem.video}" frameborder="0" allow="autoplay" style="position:absolute;top:0;left:0;width:100%;height:100%;" title="BTM wapping RAW"></iframe></div><script src="https://player.vimeo.com/api/player.js"><\/script>`),""!=currentItem.info?w_infoDiv.innerHTML=`${currentItem.info}`:w_infoDiv.innerHTML="",""!=currentItem.access?w_warningDiv.innerHTML=`${currentItem.access}`:w_warningDiv.innerHTML="",""!=currentItem.audio_direction?w_directions.innerHTML=`<div class="directions-wrap"> <div class="audio-cntr"><audio id="audioDirections" controls controlsList="nodownload"><source src="${currentItem.audio_direction}" type="audio/mp3"></audio></div></div>`:w_directions.innerHTML="";let subChildHtml="";for(const key in currentItem.questions)if(currentItem.questions.hasOwnProperty(key)){let qid=extractQuestionID(currentItem.questions[key]),questionAndAnswer=removeQuestionID(currentItem.questions[key]),question=removeTextInBrackets(questionAndAnswer),answers=extractTextBetweenBrackets(questionAndAnswer),answerOptions="",radioOptions="",answerNum=1;answers.split(",").forEach((function(item){let correctAnswer,correctFlag="0";isTheAnswer(item)&&(correctFlag="1",item=item.slice(0,item.length-1)),answerOptions+='<div data-correct="'+correctFlag+'" class="answer answer-enable" id="q'+qid+answerNum+'">'+item+"</div>",radioOptions+='<input type="radio" name="boxRadio-opt-'+qid+'" id="opt-'+qid+answerNum+'" value="q'+qid+answerNum+'">',answerNum++})),subChildHtml+='<div class="q-title">QUESTION '+qid+"</div>",subChildHtml+=`<p class="question">${question}</p>`,subChildHtml+=`<div class="options opt-${qid}">${answerOptions}</div>`,subChildHtml+=`<div id="radioForm" class="hide">${radioOptions}</div>`}""==subChildHtml?(subChildHtml+="<h3>Take a break, there are no questions for this stage...</h3>",b_checkAnswers.style.display="none"):b_checkAnswers.style.display="block",w_quiz.innerHTML=subChildHtml,""!=currentItem.audio_talk?w_mediaDiv1.innerHTML=`<div class="audio-wrap"><div class="dr-green"><img src="img/dr-green.png"></div><div class="audio-cntr"><audio id="myAudio1" controls controlsList="nodownload"><source src="${currentItem.audio_talk}" type="audio/mp3"></audio></div></div>`:w_mediaDiv1.innerHTML=""}else console.log("No more items in this direction.");attachAnswerListners(),resetAnimations()}else console.log("exiting DisplayCurrentItem as no steps")}function isTheAnswer(str){return str.endsWith("*")}function resetAnimations(){addClassToElements("answer","answer-enable")}function addClassToElements(className,newClass){const elements=document.getElementsByClassName(className);for(let i=0;i<elements.length;i++)elements[i].classList.add(newClass)}function removeClassFromElements(className,newClass){const elements=document.getElementsByClassName(className);for(let i=0;i<elements.length;i++)elements[i].classList.remove(newClass)}function mapToggle(){var mapDiv;document.getElementById("map").classList.toggle("mapOpen")}function cameraToggle(){var cameraDiv;document.getElementById("camera").classList.toggle("cameraOpen")}function directionsPlayToggle(){var player=document.getElementById("audioDirections");player.classList.toggle("playing"),togglePlayPause(player);var iconDirVol=document.getElementById("iconDirVol");console.log(iconDirVol.innerHTML);let curState=iconDirVol.innerHTML;iconDirVol.innerHTML="volume_up"==curState?"volume_off":"volume_up"}function audioReset(){var player=document.getElementById("audioDirections");player.pause(),player.currentItem=0,player.src=""}function stepForward(){currentIndex<steps.length-1&&(currentIndex++,displayCurrentItem()),scrollToTop()}function stepBackward(){currentIndex>0&&(currentIndex--,displayCurrentItem()),scrollToTop()}function openDrawer(){document.getElementById("drawer").classList.add("open")}function closeDrawer(){document.getElementById("drawer").classList.remove("open")}function scrollToTop(){window.scrollTo(0,0)}function togglePlayPause(audioElement){audioElement.paused?audioElement.play():audioElement.pause()}function fadePageToBlack(){var overlay;document.getElementById("overlay").style.opacity="1"}function extractQuestionID(inputString){const extractedText=inputString.substring(0,4);return extractedText}function extractTextBetweenBrackets(inputString){const startIndex=inputString.indexOf("["),endIndex=inputString.indexOf("]");if(-1!==startIndex&&-1!==endIndex){const extractedText=inputString.substring(startIndex+1,endIndex);return extractedText}return null}function removeQuestionID(inputString){const extractedText=inputString.slice(4,inputString.length);return extractedText}function removeTextInBrackets(inputString){const startIndex=inputString.indexOf("["),endIndex=inputString.indexOf("]");return-1!==startIndex&&-1!==endIndex?inputString.substring(0,startIndex)+inputString.substring(endIndex+1):inputString}function setTeamNameLocal(teamName){console.log("setTeamnamelocal"),setLocalData("team_name",teamName)}function getTeamNameLocal(){return getLocalData("team_name")}function setLocalData(key,data){console.log("setLocaldata "+key+" "+data),localStorage.setItem(key,data)}function getLocalData(key){return localStorage.getItem("team_name")}function createX(teamName){setTeamNameLocal(teamName),saveTeam(teamName)}function removeAnswerHandler(){const answers=document.querySelectorAll(".answer");answers.forEach(box=>{let newBox=box.cloneNode(!0);box.parentNode.replaceChild(newBox,box),box=newBox})}function checkAnswers(){let answerText="",questionNum=1;const myDialogEle=document.getElementById("myDialog");myDialogEle.showModal();const dialogMessageEle=document.getElementById("dialogMessage");dialogMessageEle.innerHTML="<h4>Checking your answers...</h4>";const questions=document.querySelectorAll(".options");questions.forEach(question=>{const answers=question.children;let questionId="",notAttempted=!0,correctAnswer=!1;for(let i=0;i<answers.length;i++){let choice=answers[i],id=choice.getAttribute("id"),selected=isAnswerChosen(choice.getAttribute("class")),correct;selected&&(notAttempted=!1),selected&!!+choice.getAttribute("data-correct")&&(correctAnswer=!0),questionId=id}answerText+="<li>",answerText+="Q"+questionNum+". ",answerText+=notAttempted?"Not answered":correctAnswer?"<span class='correct'>Correct</span>":"<span class='wrong'>Wrong</span>",answerText+="</li>",questionNum++}),dialogMessageEle.innerHTML+="<ul class='check'>"+answerText+"</ul>";let answerTextComp=answerText,compResult;answerTextComp=answerTextComp.replaceAll("Not answered","NA"),answerTextComp=answerTextComp.replaceAll("</li>",","),answerTextComp=answerTextComp.replace(/(<([^>]+)>)/gi,""),saveResult(teamName+"|"+answerTextComp),removeAnswerHandler(),addClassToElements("quiz","quizLocked"),btnCheckAnswers.style.display="none"}function isAnswerChosen(str){return str.toLowerCase().includes("answer-selected")}displayCurrentItem();const addTeam=document.getElementById("addTeamName"),previousButton=document.getElementById("previousButton"),nextButton=document.getElementById("nextButton"),mapSwitch=document.getElementById("mapToggle"),cameraSwitch=document.getElementById("cameraToggle"),directionsSwitch=document.getElementById("directionsToggle"),btnCheckAnswers=document.getElementById("btnCheckAnswers");addTeam.addEventListener("click",()=>{const teamName=document.getElementById("teamName");teamName.value?(createX(teamName.value),myDialog.showModal()):alert("Please enter a team name!")}),previousButton.addEventListener("click",()=>{stepBackward()}),nextButton.addEventListener("click",()=>{stepForward()}),mapSwitch.addEventListener("click",()=>{mapToggle()}),directionsSwitch.addEventListener("click",()=>{directionsPlayToggle()}),btnCheckAnswers.addEventListener("click",()=>{checkAnswers()});